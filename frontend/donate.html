<!DOCTYPE html>
<html lang="en">
<head>
	<title>Donate - Metanoia</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<link href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500,600,700,800&display=swap" rel="stylesheet">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	
	<link rel="stylesheet" href="css/animate.css">
	
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	<link rel="stylesheet" href="css/magnific-popup.css">


	<link rel="stylesheet" href="css/bootstrap-datepicker.css">
	<link rel="stylesheet" href="css/jquery.timepicker.css">

	<link rel="stylesheet" href="css/flaticon.css">
	<link rel="stylesheet" href="css/style.css">
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
        <div class="container">
            <a class="navbar-brand" href="index.html">Metanoia</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav">
                <span class="oi oi-menu"></span> Menu
            </button>

            <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
                    <li class="nav-item"><a href="gallery.html" class="nav-link">Gallery</a></li>
                    <li class="nav-item"><a href="volunteer.html" class="nav-link">Volunteer</a></li>
                    <li class="nav-item"><a href="causes.html" class="nav-link">Causes</a></li>
                    <li class="nav-item"><a href="blog.html" class="nav-link">Blog</a></li>
                    <li class="nav-item"><a href="contact.html" class="nav-link">Contact</a></li>
                    <li class="nav-item active cta"><a href="donate.html" class="nav-link">Donate</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="hero-wrap hero-wrap-2" style="background-image: url('images/donate_bg.JPG');" data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="container">
			<div class="row no-gutters slider-text align-items-end">
				<div class="col-md-9 ftco-animate pb-5">
					<p class="breadcrumbs mb-2"><span class="mr-2"><a href="index.html">Home <i class="ion-ios-arrow-forward"></i></a></span> <span>Donate <i class="ion-ios-arrow-forward"></i></span></p>
					<h1 class="mb-0 bread">Donate</h1>
				</div>
			</div>
		</div>
	</section>

    <section class="ftco-section">
        <div class="container">
            <div class="row justify-content-center mb-4">
                <div class="col-md-8 text-center">
                    <h2 class="mb-4">Support Our Work</h2>
                    <p class="lead">Your support is the cornerstone of this transformation. By making
                         a donation, you directly invest in eradicating inadequate schools and
                          empowering future leaders. Your contribution provides not just safe classrooms
                           and essential learning materials, but also the holistic programs that develop
                            young minds. Join us in building a legacy of quality educationâ€”be the change
                             you wish to see and help us create a brighter future, one child at a time.</p>
                </div>
            </div>

            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card p-4">
                        <form id="donationForm" class="donation-form">
                            <h2 class="text-center font-weight-bold mb-4">Donation Form</h2>
                            <div class="form-group
                            <label for="lastName">Amount</label>
                            <div class="form-group">
                                <input id="customAmount" name="amount" type="number" class="form-control mt-2" placeholder="Enter amount (GHS)" min="1" step="1" value="" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="firstName">First name</label>
                                    <input type="text" class="form-control" id="firstName" name="firstName" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="lastName">Last name</label>
                                    <input type="text" class="form-control" id="lastName" name="lastName" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="email">Email address</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="frequency">Donation type</label>
                                    <select id="frequency" name="frequency" class="form-control">
                                        <option value="one-time" selected>One-time</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="annual">Annual</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="designation">Designation (optional)</label>
                                    <input type="text" class="form-control" id="designation" name="designation" placeholder="e.g. General Fund">
                                </div>
                            </div>

                            <h5 class="mt-3">Payment method</h5>
                            <div class="form-group">
                                <div class="custom-control custom-radio">
                                <b><input type="radio" id="pmPaystack" name="paymentMethod" class="custom-control-input" value="paystack" checked>
                                    <label class="custom-control-label" for="pmPaystack">Paystack</label></b>
                                </div>
                            </div>

                            <div class="form-group">
                                <button type="submit" class="btn btn-primary btn-block">Donate now</button>
                            </div>

                            <div id="donationResult" class="alert d-none" role="alert"></div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <section class="ftco-hireme">
		<div class="container">
			<div class="row justify-content-between">
				<div class="col-md-8 col-lg-8 d-flex align-items-center">
					<div class="w-100">
						<h2>Best Way to Make a Difference in the Lives of Others</h2>
					</div>
				</div>
				<div class="col-md-4 col-lg-4 d-flex align-items-center justify-content-end">
					<p class="mb-0"><a href="volunteer.html" class="btn btn-primary py-3 px-4">Become A Volunteer</a></p>
				</div>
			</div>
		</div>
	</section>


    <footer class="footer">
		<div class="container">
			<div class="row">
				<div class="col-md-6 col-lg-3 mb-4 mb-md-0">
					<h2 class="footer-heading">Metanoia.</h2>
					<p> <b>Metanoia Foundation</b> is dedicated to transforming lives through quality education. We work to eradicate schools under trees and in deplorable states while nurturing the holistic development of every child in underserved communities. </p>
					<ul class="ftco-footer-social p-0">
						<li class="ftco-animate"><a href="#" data-toggle="tooltip" data-placement="top" title="Twitter"><span class="fa fa-twitter"></span></a></li>
						<li class="ftco-animate"><a href="#" data-toggle="tooltip" data-placement="top" title="Facebook"><span class="fa fa-facebook"></span></a></li>
						<li class="ftco-animate"><a href="#" data-toggle="tooltip" data-placement="top" title="Instagram"><span class="fa fa-instagram"></span></a></li>
					</ul>
					<p><a href="#" class="btn btn-quarternary">Donate Now</a></p>
				</div>
				<div class="col-md-6 col-lg-3 mb-4 mb-md-0">
					<h2 class="footer-heading">Latest News</h2>
					<div class="block-21 mb-4 d-flex">
						<a class="img mr-4 rounded" style="background-image: url(images/image_1.jpg);"></a>
						<div class="text">
							<h3 class="heading"><a href="blog.html">Even the all-powerful Pointing has no control about</a></h3>
							<div class="meta">
								<div>Jul 20, 2020</div>
								<div>Admin</div>
								<div>19</div>
							</div>
						</div>
					</div>
					<div class="block-21 mb-4 d-flex">
						<a class="img mr-4 rounded" style="background-image: url(images/image_2.jpg);"></a>
						<div class="text">
							<h3 class="heading"><a href="blog.html">Even the all-powerful Pointing has no control about</a></h3>
							<div class="meta">
								<div>Jul 20, 2020</div>
								<div>Admin</div>
								<div>19</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-6 col-lg-3 pl-lg-5 mb-4 mb-md-0">
					<h2 class="footer-heading">Quick Links</h2>
					<ul class="list-unstyled">
						<li><a href="index.html" class="py-2 d-block">Home</a></li>
						<li><a href="about.html" class="py-2 d-block">About</a></li>
                        <li><a href="volunteer.html" class="py-2 d-block">Volunteer</a></li>
						<li><a href="causes.html" class="py-2 d-block">Causes</a></li>
						<li><a href="contact.html" class="py-2 d-block">Contact</a></li>
					</ul>
				</div>
				<div class="col-md-6 col-lg-3 mb-4 mb-md-0">
					<h2 class="footer-heading">Have a Questions?</h2>
					<div class="block-23 mb-3">
						<ul>
							<li><span class="icon fa fa-map"></span><span class="text">Accra, Ghana</span></li>
							<li><a href="tel:+233 000 000 000"><span class="icon fa fa-phone"></span><span class="text">+233 000 000 000</span></a></li>
							<li><a href="mailto:info@metanoia.com"><span class="icon fa fa-paper-plane"></span><span class="text">info@metanoia.com</span></a></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="row mt-5">
				<div class="col-md-12 text-center">
				<p class="copyright">
					Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | Metanoia Foundation</a>
				</p>
				<hr>
				<p class="copyright">
                Designed by <a href="#" target="_blank" rel="noopener noreferrer">SkyRon</a>
				</p>
    			</div>
			</div>
		</footer>

    <!-- loader -->
		<div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#39CADD"/></svg></div>


		<script src="js/jquery.min.js"></script>
		<script src="js/jquery-migrate-3.0.1.min.js"></script>
		<script src="js/popper.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.easing.1.3.js"></script>
		<script src="js/jquery.waypoints.min.js"></script>
		<script src="js/jquery.stellar.min.js"></script>
		<script src="js/jquery.animateNumber.min.js"></script>
		<script src="js/bootstrap-datepicker.js"></script>
		<script src="js/jquery.timepicker.min.js"></script>
		<script src="js/owl.carousel.min.js"></script>
		<script src="js/jquery.magnific-popup.min.js"></script>
		<script src="js/scrollax.min.js"></script>
		<script src="js/main.js"></script>

    <script>
       // Donation form with backend integration
       (function () {
           const form = document.getElementById('donationForm');
           const presetRadios = document.getElementsByName('preset');
           const customAmount = document.getElementById('customAmount');
           const result = document.getElementById('donationResult');
           const pmRadios = document.getElementsByName('paymentMethod');

           // when a preset is selected, update custom amount
           for (const r of presetRadios) {
               r.addEventListener('change', () => { customAmount.value = r.value; });
           }

           form.addEventListener('submit', async function (e) {
               e.preventDefault();

               // simple validation
               const amount = parseFloat(customAmount.value);
               if (!amount || amount <= 0) {
                   result.className = 'alert alert-danger';
                   result.textContent = 'Enter a valid donation amount.';
                   result.classList.remove('d-none');
                   return;
               }

               const email = form.email.value.trim();
               const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
               if (!email || !emailRegex.test(email)) {
                   result.className = 'alert alert-danger';
                   result.textContent = 'Please enter a valid email address.';
                   result.classList.remove('d-none');
                   return;
               }

               // gather data
               const data = {
                   amount: amount.toFixed(2),
                   firstName: form.firstName.value.trim(),
                   lastName: form.lastName.value.trim(),
                   email: email,
                   frequency: form.frequency.value,
                   designation: form.designation.value.trim(),
                   paymentMethod: Array.from(pmRadios).find(r => r.checked).value
               };

               // Show a processing message
               result.className = 'alert alert-info';
               result.textContent = 'Processing donation...';
               result.classList.remove('d-none');

               try {
                   await processPaystackPayment(data);
               } catch (error) {
                   result.className = 'alert alert-danger';
                   result.textContent = 'Payment failed: ' + error.message;
                   result.classList.remove('d-none');
               }
           });


           // Process Paystack payment
           async function processPaystackPayment(data) {
               try {
                   // Load Paystack SDK dynamically to avoid document.write
                   if (!window.PaystackPop) {
                       await new Promise((resolve, reject) => {
                           const script = document.createElement('script');
                           script.src = 'https://js.paystack.co/v1/inline.js';
                           script.onload = resolve;
                           script.onerror = reject;
                           document.head.appendChild(script);
                       });
                   }

                   // Fetch Paystack public key from backend
                   const configResponse = await fetch('http://localhost:5000/api/payments/paystack/config');
                   if (!configResponse.ok) throw new Error('Failed to load payment configuration');
                   const config = await configResponse.json();

                   // Initialize payment on server
                   const response = await fetch('http://localhost:5000/api/payments/paystack/initialize', {
                       method: 'POST',
                       headers: { 'Content-Type': 'application/json' },
                       body: JSON.stringify(data)
                   });

                   if (!response.ok) throw new Error('Failed to initialize payment');

                   const { authorization_url, reference, donationId } = await response.json();

                   // Use Paystack inline SDK
                   const handler = PaystackPop.setup({
                       key: config.publicKey, // Use key from backend
                       email: data.email,
                       amount: Math.round(data.amount * 100), // Convert to pesewas (GHS equivalent of kobo)
                       currency: 'GHS', // Use GHS for Ghanaian Cedi
                       ref: reference,
                       callback: function(response) {
                           // Payment successful, verify on server
                           fetch('http://localhost:5000/api/payments/paystack/verify', {
                               method: 'POST',
                               headers: { 'Content-Type': 'application/json' },
                               body: JSON.stringify({ reference: response.reference, donationId })
                           })
                           .then(res => res.json())
                           .then(data => {
                               if (data.status === 'success') {
                                   result.className = 'alert alert-success';
                                   result.textContent = 'Thank you! Your donation has been processed successfully.';
                                   form.reset();
                               } else {
                                   result.className = 'alert alert-danger';
                                   result.textContent = 'Payment verification failed.';
                               }
                               result.classList.remove('d-none');
                           })
                           .catch(error => {
                               result.className = 'alert alert-danger';
                               result.textContent = 'Payment verification failed: ' + error.message;
                               result.classList.remove('d-none');
                           });
                       },
                       onClose: function() {
                           result.className = 'alert alert-warning';
                           result.textContent = 'Payment cancelled.';
                           result.classList.remove('d-none');
                       }
                   });
                   handler.openIframe();
               } catch (error) {
                   throw new Error(error.message || 'Paystack payment failed');
               }
           }
       })();
    </script>
 
</body>
</html>